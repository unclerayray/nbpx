<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../js/easyui/themes/gray/easyui.css">
<link rel="stylesheet" type="text/css" href="../js/easyui/themes/icon.css"/>
<script type="text/javascript" src="../js/easyui/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="../js/easyui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../js/easyui/locale/easyui-lang-zh_CN.js"></script>
<style>
	.itemText{width:100px;text-align:right;;height:30px;padding-right:10px; vertical-align:top}
	.formTable td{vertical-align:top}
</style>
<script language="JavaScript">
	var courseTypes = [];
	//console.log('before load');
	$.ajax('../struts/Course_queryComboCourseTypes', {
		type : 'POST',
		dataType : 'json',
		success : function(data) {
			courseTypes = data;
		}
	});
</script>
<title>内部发布的讲师列表</title>
</head>
<body class="easyui-layout">
	
	<div id="toolbar" style="padding: 5px; height: auto">
		<div>
			讲师名： <input id="q_teacherName" name="q_teacherName" style="width: 180px;">
			<a href="javascript:void(0)" class="easyui-linkbutton"
			iconCls="icon-search" onclick="queryTeacherInfo()">搜索</a> <a
			href="javascript:void(0)" class="easyui-linkbutton"
			iconCls="icon-undo" onclick="$('#toolbar').form('clear');">重置</a>
		<a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true"
		onclick="$('#fm').form('clear');$('#dlg').dialog('open').dialog('setTitle', '新增讲师');$('#isMale').attr('checked', 'checked');">新增讲师</a>
		<a href="#"
			class="easyui-linkbutton" iconCls="icon-edit" plain="true"
			onclick="editTeacherInfo()">修改</a> 
			<a href="#"
				class="easyui-linkbutton" iconCls="icon-search" plain="true"
				onclick="auditTeacherInfo()">激活/锁定</a> <a href="#"
				class="easyui-linkbutton" iconCls="icon-remove" plain="true"
				onclick="deleteTeacherInfo()">删除</a>
		</div>
	</div>
	
	<div region="center" border="false" style='padding:5px'>
		<table class="easyui-datagrid" id="dg" 
		data-options="fit:true,rownumbers:true,singleSelect:true,url:'../struts/TeacherInfo_queryInnerTeacherInfo',toolbar:'#toolbar',
		singleSelect:true,
		autoRowHeight:false,
		pagination:true,
		pageSize:20">
		<thead>
			<tr>
				<th data-options="field:'teacherId',width:80,hidden:true">主键</th> 
				<th data-options="field:'realName',sortable:true,width:80">授课姓名</th>
				<th data-options="field:'realRealName',sortable:true,width:70">真实姓名</th>
				<th data-options="field:'birthday',sortable:true,width:80">生日</th>
				<th data-options="field:'majorCatgory',sortable:true,width:80,formatter:function(value,row){
				for(var i=0; i<courseTypes.length; i++){
                    if (courseTypes[i].codeName == value) return courseTypes[i].showName;
                }
				return value;
				}">主讲类别</th>
				<th data-options="field:'externalPayment',sortable:true,width:60">内部课酬</th>
				<th data-options="field:'internalPayment',sortable:true,width:60">外部课酬</th>
				<th data-options="field:'fax',sortable:true,width:80">传真</th>
				<th data-options="field:'cellphone',sortable:true,width:80">手机</th>
				<th data-options="field:'expertIn',sortable:true,width:80">擅长领域</th>
				<th data-options="field:'category',hidden:true,sortable:true,width:80">类别</th><!-- 内训师，培训师 -->
				<th data-options="field:'introduction',hidden:true,sortable:true,width:80">介绍</th>
				<th data-options="field:'createDate',sortable:true,width:70">新建时间</th>
				<th data-options="field:'createBy',sortable:true,width:70">发布者</th>
				<th data-options="field:'assistName',width:60">助理姓名</th>
				<th data-options="field:'assistQq',sortable:true,width:80">助理QQ</th>
				<th data-options="field:'assistPhone',sortable:true,width:70">助理电话</th>
				<th data-options="field:'assistEmail',sortable:true,width:70">助理邮箱</th>
				<th data-options="field:'remarks',sortable:true,hidden:true,width:70">备注</th>
				<th data-options="field:'isMale',sortable:true,width:30,formatter:function(value,row){if(row.isMale) return '男';else return '女';}">性别</th>
				<th data-options="field:'state',width:45,sortable:true,formatter:function(value,row){if(row.state) return '已激活';else return '<font color=red>锁定</font>';}  ">状态</th>
			</tr>
		</thead>
	</table>
</div>

<div id="dlg" class="easyui-dialog" title="修改用户信息" closed="true" style="width:600px;height:550px;padding:10px;"
			data-options="buttons: [{
					text:'保存',
					iconCls:'icon-ok',
					handler:function(){
						saveTeacherInfo();
					}
				},{
					text:'取消',
					handler:function(){
						$('#dlg').dialog('close');
					}
				}],
				onClose : function() {$('.validatebox-tip').remove();}">
				<form id="fm" method="post" enctype="multipart/form-data" novalidate> 
					<table cellspacing="0" cellpadding="0" class="formTable">
						<tr>
							<td class="itemText">真实姓名:</td>
							<td><input id="realName" name="realName" class="easyui-validatebox" required="true"></td>
							<td class="itemText">出生日期:</td>
							<td>
								<input id="birthday" name="birthday"  class="easyui-datebox"  required="true">
								<input id="teacherId" name="teacherId" type="hidden">
								<input id="createBy" name="createBy" type="hidden">
								<input id="createDate" name="createDate" type="hidden">
								<input id="state" name="state" type="hidden">
							</td>
						</tr>
						<tr>
							<td class="itemText">照片:</td>
							<td><input type="file" id='file' name="file"></td>
						</tr>
						<tr>
							<td class="itemText">真实姓名:</td>
							<td><input id="realRealName" name="realRealName"></td>
							<td class="itemText">先生/女士:</td>
							<td><input name="isMale" id="isMale" type="checkbox"></td>
						</tr>
						<tr><td class="itemText">主讲类别:</td><td>
								<input class="easyui-combobox"
							style="width: 130px;" name="majorCatgory" id="majorCatgory"
							data-options="  
							url:'../struts/Course_queryComboCourseTypes',  
							valueField:'codeName',  
							textField:'showName',
							panelHeight:'200',
							editable:false ,
							required:true,
							tipPositionY:'center',
							tipPositionX:'right',
							className:'tip-darkgray',
							missingMessage:'必填项'
							"></td>
							<td class="itemText">对外课酬:</td>
							<td><input id="externalPayment" name="externalPayment" class="easyui-validatebox" required="true">
							</td>
						</tr>
						<tr>
							<td class="itemText">协议课酬:</td>
							<td><input id="internalPayment" name="internalPayment" class="easyui-validatebox" required="true"></td>
							<td class="itemText">传真:</td><td><input id="fax" name="fax" class="easyui-validatebox" required="true"></td>
						</tr>
						<tr>
							<td class="itemText">联系电话:</td>
							<td><input id="telephone" name="telephone" class="easyui-validatebox" required="true"></td>
							<td class="itemText">移动电话:</td>
							<td><input id="cellphone" name="cellphone" class="easyui-validatebox" required="true"></td>
						</tr>
						<tr>
							<td class="itemText">助理姓名:</td>
							<td><input id="assistName" name="assistName"></td>
							<td class="itemText">助理电话:</td>
							<td><input id="assistPhone" name="assistPhone"></td>
						</tr>
						<tr>
							<td class="itemText">助理QQ:</td>
							<td><input id="assistQq" name="assistQq"></td>
							<td class="itemText">助理邮箱:</td>
							<td><input id="assistEmail" name="assistEmail"></td>
						</tr>
						<tr>
							<td class="itemText">个人简介:</td>
							<td colspan="3"><textarea id="introduction" style="width:420px;height:70px" name="introduction"></textarea></td>
						</tr>
						<tr>
							<td class="itemText">擅长项目:</td>
							<td colspan="3"><textarea id="expertIn" style="width:420px;height:70px" name="expertIn"></textarea></td>
						</tr>
						<tr>
							<td class="itemText">备注:</td>
							<td colspan="3"><textarea id="remarks"
									style="width: 420px; height: 70px" name="remarks"></textarea></td>
						</tr>	
					</table>
				</form>  
	</div>    

<script type="text/javascript">
function queryTeacherInfo() {
	//alert($('#q_userName').val());
	$('#dg').datagrid('load', {
		q_userName : $('#q_userName').val(),
		q_teacherName : $('#q_teacherName').val()
	});
}

function editTeacherInfo() {
	var row = $('#dg').datagrid('getSelected');
	//console.log(row);
	$('#dlg').dialog('open').dialog('setTitle', '修改');
	if (row) {
		$('#fm').form('clear');
		$('#fm').form('load', row);
		if (row.isMale)
			$('#isMale').attr('checked', 'checked');
	} else {
		$.messager.show({
			title : '温馨提示',
			msg : '请先选择一行记录',
			timeout : 2000,
			showType : 'slide'
		});
	}
}

function auditTeacherInfo() {
	var row = $('#dg').datagrid('getSelected');
	var yes = '确认要激活资料？';
	if(row.state){
		yes = '确认要锁定资料？';
	}
	if (row) {
		$.messager
		.confirm(
			'Confirm',
			yes,
			function(r) {
				if (r) {
					$
					.post(
						'../struts/TeacherInfo_auditTeacherInfo?teacherInfoId='+row.teacherId + '&state=' + row.state,
						row,
						function(data) {
							if (data.success) {
								$('#dg')
								.datagrid(
																				'reload'); // reload the Dic data
								$('#dg').datagrid('clearSelections');
							} else {
								$.messager
								.show({
									title : 'Error',
									msg : data.message,
									timeout : 3000,
									showType : 'fade'
								});
								$('#dg')
								.datagrid(
									'reload');
								$('#dg').datagrid('clearSelections');
							}
						}, 'json');
				}
			});
	}else{
		$.messager.show({
			title : '温馨提示',
			msg : '请先选择一行记录',
			timeout : 2000,
			showType : 'slide'
		});
	}
}

function saveTeacherInfo() {
			$('#fm').form('submit', {
				url : '../struts/TeacherInfo_saveTeacherInfor?objectName=teacherInfor&excluded_fields=file',
				onSubmit : function() {
					return $(this).form('validate');
				},
				success : function(data) {
					var data = eval('(' + data + ')'); // change the JSON string to javascript object  
					if (data.success) {
						$.messager.show({
							title : 'Success',
							msg : data.message,
							timeout : 3000,
							showType : 'fade'
						});
						$('#dlg').dialog('close'); // close the dialog  
						$('#dg').datagrid('reload'); // reload the Dic data    
					} else {
						$.messager.show({
							title : 'Error',
							msg : data.message,
							timeout : 3000,
							showType : 'fade'
						});
					}
				}
			});
}



function deleteTeacherInfo() {
	var row = $('#dg').datagrid('getSelected');
	if (row) {
		$.messager
				.confirm(
						'Confirm',
						'确认要删除此行记录吗?',
						function(r) {
							if (r) {
								$
										.post(
												'../struts/TeacherInfo_deleteTeacherInfo?teacherInfoId='+row.teacherId,
												row,
												function(data) {
													if (data.success) {
														$('#dg')
																.datagrid(
																		'reload'); // reload the Dic data
														$('#dg')
																.datagrid(
																		'clearSelections');
													} else {
														$.messager
																.show({
																	title : 'Error',
																	msg : data.message,
																	timeout : 3000,
																	showType : 'fade'
																});
														$('#dg')
																.datagrid(
																		'reload');
														$('#dg')
																.datagrid(
																		'clearSelections');
													}
												}, 'json');
							}
						});
	} else {
		$.messager.show({
			title : '温馨提示',
			msg : '请先选择一行记录',
			timeout : 2000,
			showType : 'slide'
		});
	}
}

</script>
</body>
</html>