<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<link rel="stylesheet" type="text/css"
	href="../js/easyui/themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="../js/poshytip-1.2/src/tip-skyblue/tip-skyblue.css">
	<link rel="stylesheet" type="text/css" href="../js/poshytip-1.2/src/tip-darkgray/tip-darkgray.css">
	<link rel="stylesheet" type="text/css"
	href="../js/easyui/themes/icon.css">
	<script src="../js/easyui/jquery-1.8.0.min.js"></script>
	<script src="../js/easyui/jquery.easyui.min.js"></script>
	<script src="../ckeditor/ckeditor.js"></script>
	<script src="../js/poshytip-1.2/src/jquery.poshytip.min.js"></script>
	<script src="../js/easyui/plugins/jquery.validatebox.js"></script>
	<title>字典管理界面</title>
</head>
<body >
	<table id="dg" class="easyui-datagrid"  pagination="true"  pageSize=20  onClickRow:
	onClickRow 
	loadMsg="正在加载，请稍候!"
	data-options="fit:true,rownumbers:true,singleSelect:true,url:'../struts/Dictionary_queryDictionary',toolbar:'#tb'">
	<thead>
		<tr>
			<th data-options="field:'dicId',width:80,hidden:true">主键</th>
			<th
			data-options="field:'dicType',width:120,sortable:true,formatter:function(value,row){return row.dicTypeName;}">字典类型</th>
			<th data-options="field:'codeName',sortable:true,width:120">字典编码</th>
			<th data-options="field:'orderNum',sortable:true,width:100">排列顺序</th>
			<th data-options="field:'showName',sortable:true,width:120">字典项值</th>
			<th data-options="field:'discription',sortable:true,width:250">字典描述</th>
			<th
			data-options="field:'flag',sortable:true,width:50,formatter:function(value,row){if(row.flag) {return '启用';}else{return '禁用';}}">状态</th>
		</tr>
	</thead>
</table>
<div id="tb" style="padding: 5px; height: auto">
	<div style="margin-bottom: 5px">
		<a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true"
		onclick="newDic(false)">新增字典</a> <a href="#"
		class="easyui-linkbutton" iconCls="icon-edit" plain="true"
		onclick="editDic(false)">修改字典</a> <a href="#"
		class="easyui-linkbutton" iconCls="icon-remove" plain="true"
		onclick="destroyDic(false)">删除字典</a>
	</div>
	<div>
		字典类型: <input class="easyui-combobox" name="p_dicType" id="p_dicType"
		data-options="  
		url:'../struts/Dictionary_queryComboDicTypes',  
		valueField:'codeName',  
		textField:'showName',   
		panelHeight:'auto'  ,
		strict:true,
		onSelect: function(rec){  
		var url = '../struts/Dictionary_queryComboDics?p_dicType='+rec.codeName;  
		$('#p_codeName').combobox('clear');  
		$('#p_codeName').combobox('reload', url);  
	}
	">
	字典项值： <input class="easyui-combobox" name="p_codeName"
	id="p_codeName"
	data-options="   
	url:'../struts/Dictionary_queryComboDics',
	valueField:'codeName',  
	textField:'showName',  
	panelHeight:'auto'  ,
	strict:true
	">
	<a href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-search" onclick="queryDic(true)">搜索</a> <a
	href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-undo" onclick="clearTollBar()">重置</a> <a
	href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-dic" onclick="manageDicType()">字典种类维护</a> <a
	href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-dic" onclick="$('#fm-bc').form('clear');$('#dlg-dc').dialog('open').dialog('setTitle', '批量导入字典');">批量导入字典</a>
</div>
</div>
<!-- single dialog -->
<div id="dlg" class="easyui-dialog"
style="width: 360px; height: 300px; padding: 5px 5px" closed="true"  cache="false" 
modal="true" buttons="#dlg-buttons">
<form id="fm" method="post">
	<div class="fitem">
		<input data-option="id:'dicId'" name="dicId"
		class="easyui-validatebox" type="hidden">
	</div>

	<div id="dicTypeInForm" class="fitem">
		<label>字典类型:</label> <select class="easyui-combobox"
		style="width: 130px;" name="dicType" id="dicTypeField"
		data-options="  
		url:'../struts/Dictionary_queryComboDicTypes',  
		valueField:'codeName',  
		textField:'showName',  
		panelHeight:'auto'  ,
		editable:false 
		">
	</select>
</div>
<div class="fitem">
	<label>字典项值:</label> <input class="easyui-validatebox"
	name="showName" required="true" style="width: 130px;"><input  type="hidden" 
	name="codeName" style="width: 130px;">
</div>
<div class="fitem">
	<label>字典顺序编号:</label> <input id="codeNameItem" 
	name="orderNum" style="width: 130px;">
</div>
<div class="fitem">
	<label>字典描述:</label>
	<textarea class="easyui-textarea" name="discription"
	style="height: 60px; width: 130px;" type="textarea"></textarea>
</div>
<div class="fitem">
	<label>是否启用:</label> <input name="flag" id="flag" type="checkbox">
</div>
</form>
</div>
<!-- single dialog -->

<!-- multiple dialog -->
<div id="dlg-dc" class="easyui-dialog"
style="width: 720px; height: 500px; padding: 5px 5px" closed="true"  cache="false" 
modal="true" buttons="#dlg-buttons-a">
<form id="fm-bc" method="post">
	<div id="dicTypeInForm-bc" class="fitem">
		<label>字典类型:</label> <select class="easyui-combobox"
		style="width: 130px;" name="p_dicType" id="dicTypeFielda"
		data-options="  
		url:'../struts/Dictionary_queryComboDicTypes',  
		valueField:'codeName',  
		textField:'showName',  
		panelHeight:'auto'  ,
		editable:false,
		required:true,tipPositionY:'center',tipPositionX:'right',className:'tip-darkgray',missingMessage:'字典类型是必填项'
		">
	</select>
</div>
<div class="fitem">
	<label>字典项值:</label>
		<textarea class="easyui-textarea" id="dics" name="dics" data-options="required:true,tipPositionY:'center',tipPositionX:'right',className:'tip-darkgray',missingMessage:'导入字典项值不能为空'"
		style="height: 360px; width: 500px;" type="textarea" required="true"></textarea>
</div>
<div>
	<tr>
	<td class="itemText"  colspan="2">
	<div>
		<label>多个字典请用逗号隔开，导入的字典可以是系统中已存在的，程序会自动忽略！</label>
		</div>
	</td>
	</tr>
</div>
</form>
</div>
<!-- multiple dialog -->

<div id="dlg-buttons">
	<a href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-ok" onclick="saveDic()">保存</a> <a
	href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')">取消</a>
</div>
<div id="dlg-buttons-a">
	<a href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-ok" onclick="importDics()">导入</a> <a
	href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-cancel" onclick="javascript:$('#dlg-dc').dialog('close')">取消</a>
</div>
<!--字典种类信息维护 -->

<div id="tb_dt" style="padding: 5px; height: auto">
	<div style="margin-bottom: 5px">
		<a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true"
		onclick="newDic(true)">新增字典类</a> <a href="#"
		class="easyui-linkbutton" iconCls="icon-edit" plain="true"
		onclick="editDic(true)">修改字典类</a> <a href="#"
		class="easyui-linkbutton" iconCls="icon-remove" plain="true"
		onclick="destroyDic(true)">删除字典类</a>
	</div>
</div>
<div id="dlg_dt" class="easyui-dialog"
style="width: 700px; height: 435px; padding: 5px 10px" closed="true"
modal="true">
<table id="dg_dt" class="easyui-datagrid"
style="width: 650px; height: 375px" pagination="true" onClickRow:
onClickRow 
loadMsg="正在加载，请稍候!" 
data-options="fit:true,rownumbers:true,singleSelect:true,url:'../struts/Dictionary_queryDicType',toolbar:'#tb_dt'">
<thead>
	<tr>
		<th data-options="field:'dicId',width:80,hidden:true">主键</th>
		<th data-options="field:'codeName',sortable:true,width:100">字典类编码</th>
		<th data-options="field:'showName',sortable:true,width:100">字典类</th>
		<th data-options="field:'discription',width:330">字典类描述</th>
		<th
		data-options="field:'flag',width:50,sortable:true,formatter:function(value,row){if(row.flag) {return '启用';}else{return '禁用';}}">状态</th>
	</tr>
</thead>
</table>
</div>
<script type="text/javascript">
function queryDic() {
	$('#fm').form('load', row);
}
function clearTollBar() {
	$('#tb').form('clear');
}
function queryDic(atr1) {
			//alert("ahhahhahahah  " + $('#p_dicType').combobox('getValue'));
			$('#dg').datagrid('load', {
				p_dicType : $('#p_dicType').combobox('getValue'),
				p_codeName : $('#p_codeName').combobox('getValue')
			});
		}
		function newDic(attr) {
			if (attr == true) {
				$('#dlg').dialog('open').dialog('setTitle', '新建字典类别');
				document.getElementById('dicTypeInForm').style.display = 'none';
			} else {
				$('#dlg').dialog('open').dialog('setTitle', '新建字典项');
				document.getElementById('dicTypeInForm').style.display = 'inline';
			}
			$('#fm').form('clear');
			//setEditable();
			$('#flag').attr('checked', 'checked');
		}
		function editDic(attr) {
			var row;
			if (attr == true) {
				row = $('#dg_dt').datagrid('getSelected');
			} else {
				row = $('#dg').datagrid('getSelected');
			}

			//alert("row.flag: "+row.flag)
			if (row) {
				if (attr == true) {
					$('#dlg').dialog('open').dialog('setTitle', '编辑字典类型');
				} else {
					$('#dlg').dialog('open').dialog('setTitle', '编辑字典项');
				}
				//setUnEditable();
				$('#fm').form({
					onLoadSuccess : function(data) {
						if (data.flag)
							$('#flag').attr('checked', 'checked');
						else
							$('#flag').attr('checked', false);
					}
				});
				if (attr == true) {
					document.getElementById('dicTypeInForm').style.display = 'none';
				}else{
					document.getElementById('dicTypeInForm').style.display = 'inline';
				}
				$('#fm').form('load', row);
			} else {
				$.messager.show({
					title : '温馨提示',
					msg : '请先选择一行记录',
					timeout : 2000,
					showType : 'slide'
				});
			}
		}
		function saveDic() {
			$('#fm').form('submit', {
				url : '../struts/Dictionary_saveDic?objectName=dictionary',
				onSubmit : function() {
					return $(this).form('validate');
				},
				success : function(data) {
					var data = eval('(' + data + ')'); // change the JSON string to javascript object  
					if (data.success) {
						$.messager.show({
							title : 'Success',
							msg : data.message,
							timeout : 3000,
							showType : 'fade'
						});
						$('#dlg').dialog('close'); // close the dialog  
						$('#dg').datagrid('reload'); // reload the Dic data    
						$('#dg_dt').datagrid('reload'); // reload the Dic data    
						$('#p_dicType').combobox('reload');
						$('#dicTypeField').combobox('reload');
					} else {
						$.messager.show({
							title : 'Error',
							msg : data.message,
							timeout : 3000,
							showType : 'fade'
						});
					}
				}
			});
		}
		function destroyDic(attr) {
			var row;
			if (attr == true) {
				row = $('#dg_dt').datagrid('getSelected');
			} else {
				row = $('#dg').datagrid('getSelected');
			}
			if (row) {
				$.messager
				.confirm(
					'Confirm',
					'确认要删除此行记录吗?',
					function(r) {
						if (r) {
							$
							.post(
								'../struts/Dictionary_deleteDic?objectName=dictionary',
								row,
								function(data) {
									if (data.success) {
										$('#dg')
										.datagrid(
																				'reload'); // reload the Dic data
										$('#dg_dt')
										.datagrid(
																				'reload'); // reload the Dic data  
									} else {
										$.messager
										.show({
											title : 'Error',
											msg : data.message,
											timeout : 3000,
											showType : 'fade'
										});
										$('#dg')
										.datagrid(
											'reload');
										$('#dg_dt')
										.datagrid(
																				'reload'); // reload the Dic data    
									}
								}, 'json');
						}
					});
			}
		}

		function manageDicType() {
			$('#dlg_dt').dialog('open').dialog('setTitle', '字典类型维护');
		}
		function importDics() {
			$('#fm-bc').form('submit', {
				url : '../struts/Dictionary_batchImport',
				onSubmit : function() {
					return $(this).form('validate');
				},
				success : function(data) {
					var data = eval('(' + data + ')'); // change the JSON string to javascript object  
					if (data.success) {
						$.messager.show({
							title : 'Success',
							msg : data.message,
							timeout : 3000,
							showType : 'fade'
						});
						$('#dlg-dc').dialog('close'); // close the dialog  
						$('#dg').datagrid('reload'); // reload
					} else {
						$.messager.show({
							title : 'Error',
							msg : data.message,
							timeout : 3000,
							showType : 'fade'
						});
					}
				}
			});
		}
		function setEditable(){
			$('#codeNameItem').attr('readonly',false);
		}
		function setUnEditable(){
			$('#codeNameItem').attr('readonly',true);
		}
		</script>
		<style type="text/css">
		#fm {
			margin: 0;
			padding: 10px 40px;
		}

		.ftitle {
			font-size: 14px;
			font-weight: bold;
			padding: 5px 0;
			margin-bottom: 10px;
			border-bottom: 1px solid #ccc;
		}

		.fitem {
			margin-bottom: 5px;
		}

		.fitem label {
			display: inline-block;
			width: 80px;
		}
		</style>
	</body>
	</html>