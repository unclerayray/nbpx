<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../js/easyui/themes/gray/easyui.css">
<link rel="stylesheet" type="text/css" href="../js/easyui/themes/icon.css"/>
<script type="text/javascript" src="../js/easyui/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="../js/easyui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../js/easyui/locale/easyui-lang-zh_CN.js"></script>
<style>
	.itemText{width:100px;text-align:right;;height:30px;padding-right:10px; vertical-align:top}
	.formTable td{vertical-align:top}
</style>
<script language="JavaScript">
	var cityDics = [];
	//console.log('before load');
	$.ajax('../struts/Dictionary_getComboDicByType?p_dicType=007', {
		type : 'POST',
		dataType : 'json',
		success : function(data) {
			cityDics = data;
		}
	});

	function addAdmin(){
		$('#add-admin-dlg').dialog('open').dialog('setTitle', '新增后台用户');
	}

	function saveAdmin(){
		$('#admin-fm').form('submit', {
			url : '../struts/Admin_saveAdmin?objectName=admin',
			onSubmit : function() {
				return $('#admin-fm').form('validate');
			},
			success : function(data) {
				var data = eval('(' + data + ')'); // change the JSON string to javascript object  
				if (data.success) {
					$.messager.show({
						title : 'Success',
						msg : data.message,
						timeout : 3000,
						showType : 'fade'
					});
					$('##add-admin-dlg').dialog('close'); // close the dialog  
					$('#dg').datagrid('reload'); // reload
				} else {
					$.messager.show({
						title : 'Error',
						msg : data.message,
						timeout : 3000,
						showType : 'fade'
					});
				}
			}
		});
	}

	function removeUser(){
		var row = $('#dg').datagrid('getSelected');
		if (row) {
			$.messager
					.confirm(
							'Confirm',
							'确认要删除此行记录吗?',
							function(r) {
								if (r) {
									$
											.post(
													'../struts/Admin_removeAdmin?objectName=admin',
													row,
													function(data) {
														if (data.success) {
															$('#dg')
																	.datagrid(
																			'reload'); // reload the Dic data
															$('#dg')
																	.datagrid(
																			'clearSelections');
														} else {
															$.messager
																	.show({
																		title : 'Error',
																		msg : data.message,
																		timeout : 3000,
																		showType : 'fade'
																	});
															$('#dg')
																	.datagrid(
																			'reload');
															$('#dg')
																	.datagrid(
																			'clearSelections');
														}
													}, 'json');
								}
							});
		} else {
			$.messager.show({
				title : '温馨提示',
				msg : '请先选择一行记录',
				timeout : 2000,
				showType : 'slide'
			});
		}
	}
</script>
<title>管理员列表</title>
	<script type="text/javascript">
		var toolbar = [
		{
			text:'激活',
			iconCls:'icon-remove',
			handler:function(){
				var currUser = $('#grid').datagrid('getSelected');
				var index = $('#grid').datagrid('getRowIndex',currUser);
				currUser.flag = 'true';
				$.ajax({
					url:'../struts/Admin_saveAdmin?objectName=admin',
					data:currUser,
					success:function(){
						$('#grid').datagrid('reload');
					}
				})
			}
		},{
			text:'锁定',
			iconCls:'icon-add',
			handler:function(){
				var currUser = $('#grid').datagrid('getSelected');
				var index = $('#grid').datagrid('getRowIndex',currUser);
				currUser.flag = 'false';
				$.ajax({
					url:'../struts/Admin_saveAdmin?objectName=admin',
					data:currUser,
					success:function(){
						$('#grid').datagrid('reload');
					}
				})
			}
		},
		{
			text:'新增',
			iconCls:'icon-remove',
			handler:function(){
				addAdmin();
			}
		},{
			text:'删除',
			iconCls:'icon-add',
			handler:function(){
				removeUser();
			}
		}
		];
	</script>
</head>
<body class="easyui-layout">
	<div region="center" border="false" style='padding:5px'>  
		<table class="easyui-datagrid" id="grid" 
				data-options="fit:true,rownumbers:true,singleSelect:true,url:'../struts/Admin_queryAdmins',toolbar:toolbar,
					singleSelect:true,
					autoRowHeight:false">
			<thead>
				<tr>
					<th data-options="field:'adminId',width:80,hidden:true">主键</th> 
					<th data-options="field:'userName',sortable:true,width:120">用户名</th>
					<th data-options="field:'realname',sortable:true,width:120">真名</th>
					<th data-options="field:'password',hidden:true,sortable:true,width:120">用户名</th>
					<th data-options="field:'flag',width:100,sortable:true,formatter:function(value,row){if(row.flag) return '已激活';else return '<font color=red>锁定</font>';}  ">状态</th>
				</tr>
			</thead>
		</table>
	</div>

	<div id="add-admin-dlg" class="easyui-dialog"
	style="width: 300px; height: 200px; padding: 5px 5px" closed="true"
	modal="true"  data-options="buttons: [{
											text:'确定',
											iconCls:'icon-ok',
											handler:function(){
											saveAdmin(); } 
										}]">
		<form id="admin-fm" method="post">
			<table cellspacing="0" cellpadding="0" class="formTable">
				<tr>
					<td class="itemText"><label>用户名:</label></td>
					<td>
						<input id="userName" name="userName" data-options="required:true,missingMessage:'不能为空'"  class="easyui-validatebox" type="text"/>
					</td>
				</tr>
				<tr>
					<td class="itemText"><label>初始密码:</label></td>
					<td>
						<input id="passWord" name="passWord" data-options="required:true,missingMessage:'不能为空'"  class="easyui-validatebox" type="password"/>
					</td>
				</tr>
				<tr>
					<td class="itemText"><label>真实姓名:</label></td>
					<td>
						<input id="realname" name="realname" data-options="required:true,missingMessage:'不能为空'"  class="easyui-validatebox" type="text"/>
						<input id="flag" name="flag" value="true" type="hidden"/>
					</td>
				</tr>
			</table>
		</form>
	</div>
</body>
</html>