<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="stylesheet" type="text/css"
	href="../js/easyui/themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="../js/poshytip-1.2/src/tip-skyblue/tip-skyblue.css">
	<link rel="stylesheet" type="text/css" href="../js/poshytip-1.2/src/tip-darkgray/tip-darkgray.css">
	<link rel="stylesheet" type="text/css"
	href="../js/easyui/themes/icon.css">
	<script src="../js/easyui/jquery-1.8.0.min.js"></script>
	<script src="../js/easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="../js/easyui/locale/easyui-lang-zh_CN.js"></script> 
	<script src="../ckeditor/ckeditor.js"></script>
	<script src="../js/poshytip-1.2/src/jquery.poshytip.min.js"></script>
	<script src="../js/easyui/plugins/jquery.validatebox.js"></script>
	<title>课程管理界面</title>
</head>
<body class="easyui-layout">
	<div region="center" border="false" style='padding: 5px'></div>
	<table id="dg" class="easyui-datagrid" pagination="true" pageSize=20 onClickRow:
	onClickRow loadMsg="正在加载，请稍候!"
	data-options="fit:true,rownumbers:true, singleSelect:true,url:'../struts/Course_queryCourses',toolbar:'#tb',onDblClickRow:function(rowIndex, rowData){editCourse(rowData);}">
	<thead>
		<tr>
			<th data-options="field:'courseId',sortable:true,width:50">课程代码</th>
			<th data-options="field:'teacherId',width:120,hidden:true">讲师ID</th>
			<th data-options="field:'title',sortable:true,width:320">标题</th>
			<th data-options="field:'teacherName',sortable:true,width:80">讲师</th>
			<th data-options="field:'createdBy',sortable:true,width:80">发布者</th>
			<th data-options="field:'lastUpdatedBy',sortable:true,width:80">最近更新者</th>
			<th
			data-options="field:'category',sortable:true,width:90,formatter:function(value,row){return row.categoryName;}">课程类别</th>
			<th data-options="field:'hits',sortable:true,width:80">课程点击量</th>
			<th data-options="field:'price',sortable:true,width:80">课程收费</th>
			<th data-options="field:'lastUpdateDate',sortable:true,width:120">更新时间</th>
			<th
			data-options="field:'state',width:50,sortable:true,formatter:function(value,row){if(row.state) {return '已审核';}else{return '<font color=red>未审核</font>';}}">状态</th>
		</tr>
	</thead>
</table>
<div id="tb" style="padding: 5px; height: auto">
	<div style="margin-bottom: 5px">
		<a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true"
		onclick="newCourse()">新增公开课</a>
		<a href="#"
		class="easyui-linkbutton" iconCls="icon-edit" plain="true"
		onclick="editCourse(null)">修改</a> <a href="#"
		class="easyui-linkbutton" iconCls="icon-remove" plain="true"
		onclick="destroyCourse()">删除</a><a
		href="javascript:void(0)" class="easyui-linkbutton" plain="true"
		iconCls="icon-dic" onclick="openInfoDlg()">课程安排</a> <a href="#"
		class="easyui-linkbutton" iconCls="icon-search" plain="true"
		onclick="auditCourse()">改变审核状态</a>
	</div>
	<div>
		课程类别: <input class="easyui-combobox" name="category" id="category"
		data-options="  
		url:'../struts/Course_queryComboCourseTypes',  
		valueField:'codeName',  
		textField:'showName',  
		panelHeight:'200',
		strict:true,
		onSelect: function(rec){  
		var url = '../struts/Course_queryComboCourseCode?isInner=false&category='+rec.codeName;  
		$('#courseIdFS').combobox('clear');  
		$('#courseIdFS').combobox('reload', url);  
	}
	">
	内外部发布：<input id="p_outside" name="p_outside" class="easyui-combobox"
			data-options="panelHeight:'200',
						strict:true,
						valueField: 'value',
						textField: 'label',
						data: [{
							label: '外部',
							value: 'true'
						},{
							label: '内部',
							value: 'false'
						}],
						onSelect: function(rec){  
						var p_category = $('#category').combobox('getValue');
						var pp_outside = $('#p_outside').combobox('getValue');
						var url = '../struts/Course_queryComboCourseCode?isInner=false&category='+p_category&'p_outside='+pp_outside;  
						$('#courseIdFS').combobox('clear');  
						$('#courseIdFS').combobox('reload', url);}" 
			style="panelHeight: 30px;">
	课程名： <input id="q_title" name="q_title" style="width: 180px;">
	课程代码： <input class="easyui-combobox" name="courseId"
	id="courseIdFS"
	data-options="   
	url:'../struts/Course_queryComboCourseCode?isInner=false',
	valueField:'courseId',  
	textField:'courseId',  
	panelHeight:'200',
	strict:true
	">
	<a href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-search" onclick="queryCourse()">搜索</a> <a
	href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-undo" onclick="clearTollBar()">重置</a>
</div>
</div>

<div id="dlg" class="easyui-dialog" data-options="onClose : function() {$('.validatebox-tip').remove();}" 
style="width: 1000px; height: 500px; padding: 5px 5px; top: 5px;"
closed="true" modal="true" cache="false" buttons="#dlg-buttons">
<form id="fm" method="post">
	<table cellspacing="0" cellpadding="0" class="formTable">
		<div>
			<input id="dlg-courseId" name="courseId" type="hidden">
		</div>
		<tr>
			<td class="itemText"  colspan="3" nowrap>
				<div>
					<label>课程标题:</label> <input class="easyui-validatebox" id="courseTitle"
					name="title" data-options="required:true,tipPositionY:'center',tipPositionX:'right',className:'tip-darkgray',missingMessage:'必填项'" style="width: 512px;">
				</div>
			</td>
			<td>
				<a
				href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-dic" onclick="cutupTitle()">拆分关键词</a></td>

			</tr>
			<tr>
				<td class="itemText"  colspan="4" nowrap>
					<div>
						<label>课程关键字:</label> <input class="easyui-validatebox" id="courseKeywords" name = "keywords"
						data-options="required:true,tipPositionY:'center',tipPositionX:'right',className:'tip-darkgray',missingMessage:'课程关键字是必填项'" style="width: 500px;">
					</div>
				</td>
				<td class="itemText" nowrap>
								<div id="syncDiv">
									<label>同步到内训:</label> <input name="sync" id="sync"
									type="checkbox">
								</div>
							</td>
			</tr>
			<tr>
				<td class="itemText"  colspan="4" nowrap>
					<div>
						<label>课程超链接:</label> <input id="courseLinks" name = "links" style="width: 500px;">
					</div>
				</td>
			</tr>
			<tr>
				<td class="itemText"  colspan="4" nowrap>
					<div>
						<label>课程专题:</label> <input class="easyui-validatebox" id="courseSubject" name = "subject"
						data-options="required:true,tipPositionY:'center',tipPositionX:'right',className:'tip-darkgray',missingMessage:'课程专题是必填项'" style="width: 512px;">
					</div>
				</td>
			</tr>
			<tr>
				<td class="itemText" nowrap>
					<div>
						<label>课程编码:</label> <input id="courseCodeInForm"  class="easyui-validatebox" readonly="readonly"  style="width: 100px;"
						name="courseId">
					</div></td>
					<td class="itemText" nowrap>
						<div id="courseTypeInForm">
							<label>课程类别:</label> <input class="easyui-combobox"
							style="width: 130px;" name="category" id="category"
							data-options="  
							url:'../struts/Course_queryComboCourseTypes',  
							valueField:'codeName',  
							textField:'showName',
							panelHeight:'200',
							editable:false ,
							required:true,
							tipPositionY:'center',
							tipPositionX:'right',
							className:'tip-darkgray',
							missingMessage:'必填项'
							">
						</input>
					</div>
				</td>
				<td class="itemText" nowrap>
					<div>
						<label>课程讲师:</label>
						<input type="hidden" style="width: 0px;" name="teacherName" id="teacherName"> <input class="easyui-combobox"
						name="teacherId" id="teacherId"  style="width: 100px;" 
						data-options="
						url:'../struts/Course_queryComboTeacher',
						valueField:'teacherId',  
						textField:'realName',  
						panelHeight:'100',
						required:true,
						tipPositionY:'center',
						tipPositionX:'right',
						className:'tip-darkgray',
						missingMessage:'必填项'
						">
					</div></td>
					<td class="itemText" nowrap>
						<div>
							<label>课程费用:</label> <input class="easyui-validatebox"
							name="price"  data-options="required:true,tipPositionY:'center',tipPositionX:'right',className:'tip-darkgray',validType:'num'" style="width: 100px;">
						</div></td>
					</tr>
					<tr>
						<td  class="itemText"  colspan="5">
							<label>课程对象:</label> <input name="targets" id="courseTarget"  class="easyui-combobox" data-options="  
							url:'../struts/Dictionary_queryComboDics?p_dicType=010',   
							valueField:'codeName',  
							textField:'showName',
							panelHeight:'200',
							multiple:true,
							editable:true"  
							style="width: 800px;">
						</td>
					</tr>
					<tr>
						<td  class="itemText"  colspan="5">
							<label>课程专业:</label> <input name="major" id="courseMajor"  class="easyui-combobox" data-options="  
							url:'../struts/Dictionary_queryComboDics?p_dicType=009',   
							valueField:'codeName',  
							textField:'showName',
							panelHeight:'200',
							multiple:true,
							editable:true"
							style="width: 800px;">
						</td>
					</tr>
					<tr>
						<td  class="itemText"  colspan="5">
							<label>课程行业:</label> <input name="industry" id="courseIndustry"  class="easyui-combobox" data-options="  
							url:'../struts/Dictionary_queryComboDics?p_dicType=008',   
							valueField:'codeName',  
							textField:'showName',
							panelHeight:'200',
							multiple:true,
							editable:true "
							style="width: 800px;">
						</td>
					</tr>
					<tr>
						<td  class="itemText"  colspan="5">
							<label>课程产品:</label> <input name="product" id="courseProduct"  class="easyui-combobox" data-options="  
							url:'../struts/Dictionary_queryComboDics?p_dicType=011',   
							valueField:'codeName',  
							textField:'showName',
							panelHeight:'200',
							multiple:true,
							editable:true "
							style="width: 800px;">
						</td>
					</tr>
					<tr>
							<td class="itemText" colspan="1">
								<div>
									<label>是否已审核:</label> <input name="state" id="state"
									type="checkbox">
								</div>
							</td>
							<td class="itemText" colspan="1">
								<div>
									<label>是否推荐:</label> <input name="recommanded" id="recommanded"
									type="checkbox">
								</div>
							</td>
							<td class="itemText" colspan="1">
								<div>
									<label>是否经典:</label> <input name="classic" id="classic"
									type="checkbox">
									<input name="isInner" id="isInner" value="false" type="hidden">
								</div>
							</td>
							<td class="itemText" colspan="1" nowrap>
								<div>
									<label>是否有视频:</label> <input name="hasVideo" id="hasVideo"
									type="checkbox">
								</div>
							</td>
						</tr>
						<tr>
							<td colspan="3"  nowrap>
								<div style="margin-bottom: 5px">
									<a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true"
									onclick="insertEmptyRow()">新增开课安排</a> <a href="#"
									class="easyui-linkbutton" iconCls="icon-remove" plain="true"
									onclick="removeSelectedRow();">删除开课安排</a>
								</div>
							</td>
						</tr>
					<tr>
						<td colspan="5" nowrap>
						<table id="dg_info_in"> </table>
					</td>
					</tr>
					<tr>
						<td colspan="5">
							<div id="contentDiv">
								<textarea name="content" id="content"  style="width:900px"></textarea>
							</div></td>
						</tr>
					</table>
				</form>
			</div>

			<div id="dlg-buttons">
				<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-ok" onclick="saveCourse(true)">保存</a> <a
				href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')">取消</a>
			</div>

<!--开课城市及时间维护 -->


<div id="dlg_info" class="easyui-dialog"
style="width: 380px; height: 435px; padding: 5px 10px" closed="true"  cache="false" 
modal="true">
<div id="tb_info" style="padding: 5px; height: auto">
	<div style="margin-bottom: 5px">
		<a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true"
		onclick="newCourseInfo()">新增开课安排</a> <a href="#"
		class="easyui-linkbutton" iconCls="icon-edit" plain="true"
		onclick="editCourseInfo()">修改开课安排</a> <a href="#"
		class="easyui-linkbutton" iconCls="icon-remove" plain="true"
		onclick="destroyCourseInfo()">删除开课安排</a>
	</div>
</div>
<input id="selected_courseId" name="selected_courseId"
type="hidden">
<table id="dg_info"> </table>
</div>

<div id="dlg_addInfo" class="easyui-dialog"
style="width: 360px; height: 300px; padding: 5px 5px" closed="true"
modal="true" buttons="#dlg_addInfo-buttons">
<form id="info-fm" method="post">
	<div class="fitem">
		<input id="courseInfoId_in_fm" name="courseInfoId" type="hidden">
	</div>
	<div class="fitem">
		<input id="sId_in_fm" name="courseId" type="hidden">
	</div>
	<div class="fitem">
		<label>开始时间:</label> <input style="width: 130px;" id="startDate" name="startDate" type="text" class="easyui-datebox" data-options="required:true,tipPositionY:'center',tipPositionX:'right',className:'tip-darkgray',missingMessage:'必填项',formatter:function(date){ var y = date.getFullYear(); var m = date.getMonth()+1; var d = date.getDate(); return y+'-'+m+'-'+d;}"></input>
	</div>
	<div class="fitem">
		<label>结束时间:</label> <input style="width: 130px;" id="endDate" name="endDate" type="text" class="easyui-datebox" data-options="required:true,tipPositionY:'center',tipPositionX:'right',className:'tip-darkgray',missingMessage:'必填项',formatter:function(date){ var y = date.getFullYear(); var m = date.getMonth()+1; var d = date.getDate(); return y+'-'+m+'-'+d;}" required="required"></input>
	</div>
	<div class="fitem">
		<label>城市:</label><input type="hidden" name="cityName" id="cityName"> <select class="easyui-combobox"
		style="width: 130px;" name="city" id="city"
		data-options="  
		url:'../struts/Dictionary_queryComboDics?p_dicType=007',  
		valueField:'codeName',  
		textField:'showName',  
		panelHeight:'200',
		editable:false,required:true,tipPositionY:'center',tipPositionX:'right',className:'tip-darkgray',missingMessage:'必填项'
		">
	</select>
</div>
</form>
</div>
<div id="dlg_addInfo-buttons">
	<a href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-ok" onclick="saveCourseInfo()">保存</a> <a
	href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-cancel" onclick="javascript:$('#dlg_addInfo').dialog('close')">取消</a>
</div>
<script type="text/javascript">
function clearTollBar() {
	$('#tb').form('clear');
}
function queryCourse() {
		    $('#dg').datagrid('load', {
					category : $('#category').combobox('getValue'),  
		          	courseId : $('#courseIdFS').combobox('getValue'),
		          	p_outside : $('#p_outside').combobox('getValue'),
		          	q_title : $('#q_title').val()
			});
		}
		function newCourse() {
			$('#dlg').dialog('open').dialog('setTitle', '新建公开课');
			$('#fm').form('clear');
			$('#syncDiv').show();
			$('#dg').datagrid('clearSelections');
			createInfoGrid(null);	
			createCkeditor();
			CKEDITOR.instances.content.setData('');
			$('#state').attr('checked', 'checked');
		}
		function editCourse(rowData) {
			var row;
			if(rowData){
				row = rowData;
			}else{
				row = $('#dg').datagrid('getSelected');
			}
			if (row) {
				$('#fm').form({
					onBeforeLoad : function(param) {
						$('#courseTarget').combobox({
							url:'../struts/Dictionary_queryComboDics?p_dicType=010',  
							valueField:'codeName',  
							textField:'showName',
							panelHeight:'200',
							multiple:true,
							editable:true
						}); 
						$('#courseMajor').combobox({
							url:'../struts/Dictionary_queryComboDics?p_dicType=009',  
							valueField:'codeName',  
							textField:'showName',
							panelHeight:'200',
							multiple:true,
							editable:true
						}); 
						$('#courseIndustry').combobox({
							url:'../struts/Dictionary_queryComboDics?p_dicType=008',  
							valueField:'codeName',  
							textField:'showName',
							panelHeight:'200',
							multiple:true,
							editable:true
						}); 
						$('#courseProduct').combobox({
							url:'../struts/Dictionary_queryComboDics?p_dicType=011',  
							valueField:'codeName',  
							textField:'showName',
							panelHeight:'200',
							multiple:true,
							editable:true
						}); 
					},
					onLoadSuccess : function(data) {
						createCkeditor();
						//alert(data.state);
						$('#syncDiv').hide();
						if (data.state)
							$('#state').attr('checked', 'checked');
						else
							$('#state').attr('checked', false);
						if (data.recommanded)
							$('#recommanded').attr('checked', 'checked');
						else
							$('#recommanded').attr('checked', false);
						if (data.classic)
							$('#classic').attr('checked', 'checked');
						else
							$('#classic').attr('checked', false);
						if (data.hasVideo)
							$('#hasVideo').attr('checked', 'checked');
						else
							$('#hasVideo').attr('checked', false);

						//$('#courseKeywords').combobox('setValues',data.keywords.split(','));
						if(data.targets!=''){
							$('#courseTarget').combobox('setValues',data.targets.split(','));
						}
						if(data.major!=''){
							$('#courseMajor').combobox('setValues',data.major.split(','));
						}
						if(data.industry!=''){
							$('#courseIndustry').combobox('setValues',data.industry.split(',')); 
						}
						//alert('data.product = ' + data.product);
						if(data.product!=''){
							$('#courseProduct').combobox('setValues',data.product.split(',')); 
						}

						$('#dlg').dialog('open').dialog('setTitle', '编辑课程');
					}
				});
createInfoGrid(row);
$('#fm').form('load','../struts/Course_queryCourseById?courseId='+ row.courseId);
} else {
	$.messager.show({
		title : '温馨提示',
		msg : '请先选择一行记录',
		timeout : 2000,
		showType : 'slide'
	});
}
}
function createInfoGrid(row){
	var infoUrl = '../struts/Course_queryCourseInfo?selected_courseId=none';
	if(row){
		infoUrl = '../struts/Course_queryCourseInfo?selected_courseId='+row.courseId;
	}
	$('#dg_info_in').datagrid({
		title:'课程安排',
		url:infoUrl,  
		cache:'false',
		idField:'courseInfoId',  
		width: 350,
		height: 'auto',
		onDblClickCell:function(index,field,value){
			$(this).datagrid('beginEdit', index);
			var ed = $(this).datagrid('getEditor', {index:index,field:field});
			$(ed.target).focus();
		},
		pagination:false,
		singleSelect:true,
		fitColumns:true,  
		loadMsg:'正在加载，请稍候!',
		columns:[[  
		{field:'courseInfoId',title:'主键ID',width:80,hidden:true},  
		{field:'startDate',title:'开始时间',width:140,required:true,editor:{
				type:'datebox',
				options:{required:true}}},  
		{field:'endDate',title:'结束时间',width:140,required:true,editor:{
				type:'datebox',
				options:{required:true}}},
		{field:'city',title:'城市',width:100,
			formatter:function(value,row){return row.cityName;},
			editor:{
				type:'combobox',
				options:{
					url:'../struts/Dictionary_queryComboDics?p_dicType=007',  
					valueField:'codeName',  
					textField:'showName',  
					panelHeight:'200',
					editable:false,required:true,tipPositionY:'center',tipPositionX:'right',className:'tip-darkgray',missingMessage:'必填项'
				}
			}
		}
		]]
	});
}
function saveCourse(close_dlg) {
	//var data = CKEDITOR.instances.content.getData();
	$('#teacherName').val($('#teacherId').combobox('getText'));
	var doSync = $('sync').val();
	var submitUrl = '../struts/Course_saveCourse?objectName=courseAllInfo';
	if ($('sync').val()) {
		submitUrl = '../struts/Course_saveCourse?objectName=courseAllInfo'+'&sync=true';
	};
	$('#fm').form('submit', {
		url : submitUrl,
		onSubmit : function() {
			$('#isInner').val('false');
			$('#dg_info_in').datagrid('acceptChanges');
			return $('#fm').form('validate');
		},
		success : function(data) {
					var data = eval('(' + data + ')'); // change the JSON string to javascript object  
					//alert('data = ' + data);
					if (data.success) {
						$.messager.show({
							title : 'Success',
							msg : data.message,
							timeout : 3000,
							showType : 'fade'
						});
						if(close_dlg){$('#dlg').dialog('close'); // close the dialog
					}
					//$('#p_codeName').combobox('reload');  
					//$('#p_codeName').combobox('clear');  
						$('#dg').datagrid('reload'); // reload the data grid  
						$('#dg').datagrid('clearSelections');
						//alert('data = '+data.dlg_courseId);
						$('#dlg-courseId').val(data.dlg_courseId);
						$('#selected_courseId').val(data.dlg_courseId);
						$('#courseInfoId_in_fm').val(data.dlg_courseId);
						var rows = $('#dg_info_in').datagrid('getRows');
						var infos = {};
						for(var i=0;i<rows.length;i++){
							 infos["infos[" + i + "].startDate"] = rows[i].startDate;
							 infos["infos[" + i + "].endDate"] = rows[i].endDate;
							 infos["infos[" + i + "].city"] = rows[i].city;
							 infos["infos[" + i + "].courseId"] = data.dlg_courseId;
						}
						if(rows.length>0){
							$.ajax('../struts/Course_deleteAndSaveCourseInfo', {
							      type:'POST',
							      dataType: 'json',
							      data: infos,
								  success: function(msg){
								  }
							 });
						}
					} else {
						$.messager.show({
							title : 'Error',
							msg : data.message,
							timeout : 3000,
							showType : 'fade'
						});
					}
				}
			});
}
function destroyCourse() {
	var row = $('#dg').datagrid('getSelected');
	if (row) {
		$.messager
		.confirm(
			'Confirm',
			'确认要删除此行记录吗?',
			function(r) {
				if (r) {
					$
					.post(
						'../struts/Course_deleteCourse?objectName=course',
						row,
						function(data) {
							if (data.success) {
								$('#dg')
								.datagrid(
																				'reload'); // reload the Dic data
								$('#dg').datagrid('clearSelections');
							} else {
								$.messager
								.show({
									title : 'Error',
									msg : data.message,
									timeout : 3000,
									showType : 'fade'
								});
								$('#dg')
								.datagrid(
									'reload');
								$('#dg').datagrid('clearSelections');
							}
						}, 'json');
				}
			});
	}else{
		$.messager.show({
			title : '温馨提示',
			msg : '请先选择一行记录',
			timeout : 2000,
			showType : 'slide'
		});
	}
}


function auditCourse() {
	var row = $('#dg').datagrid('getSelected');
	var yes = '确认要审核通过？';
	if(row.state){
		yes = '确认要拒绝通过？';
	}
	if (row) {
		$.messager
		.confirm(
			'Confirm',
			yes,
			function(r) {
				if (r) {
					$
					.post(
						'../struts/Course_AuditCourse?courseId='+row.courseId+'&state='+row.state,
						row,
						function(data) {
							if (data.success) {
								$('#dg')
								.datagrid(
																				'reload'); // reload the Dic data
								$('#dg').datagrid('clearSelections');
							} else {
								$.messager
								.show({
									title : 'Error',
									msg : data.message,
									timeout : 3000,
									showType : 'fade'
								});
								$('#dg')
								.datagrid(
									'reload');
								$('#dg').datagrid('clearSelections');
							}
						}, 'json');
				}
			});
	}else{
		$.messager.show({
			title : '温馨提示',
			msg : '请先选择一行记录',
			timeout : 2000,
			showType : 'slide'
		});
	}
}

function createCkeditor() {

	var config = {
		uiColor : '#A0CFEC',
		language : 'zh-cn',
		width : '800px'
	};
	var editor = CKEDITOR.instances['content'];
	if (editor) {
		editor.destroy(true);
	}
	CKEDITOR.replace('content', config);
}

function insertEmptyRow(){
			var index = 0;
			$('#dg_info_in').datagrid('insertRow', {
				index: index,
				row:{
				}
			});
			$('#dg_info_in').datagrid('selectRow',index);
			$('#dg_info_in').datagrid('beginEdit',index);
		}


function getRowIndex(){
	var tr = $('#dg_info_in').closest('tr.datagrid-row');
	return parseInt(tr.attr('datagrid-row-index'));
}

function removeSelectedRow(){
	var row = $('#dg_info_in').datagrid('getSelected');
	var rowNum = $('#dg_info_in').datagrid('getRowIndex',row);
	$('#dg_info_in').datagrid('deleteRow', rowNum);
}

function addTeacher() {
	$('#teacherFm').form('clear');		
	$('#editTeacher').dialog('open');
}

function openInfoDlg(){
		var row = $('#dg').datagrid('getSelected');
		if(row&&!row.isInner){
			var cid = row.courseId;
			$('#dlg-courseId').val(cid);
			$('#selected_courseId').val(cid);
			$('#dlg_info').dialog('open').dialog('setTitle', '课程安排');
			$('#dg_info').datagrid({
				url:'../struts/Course_queryCourseInfo?selected_courseId='+cid,  
				idField:'courseInfoId',  
				width: 350,
				height:355,  
				pagination:false,  
				toolbar:'#tb_info',
				singleSelect:true,
				fitColumns:true,  
				loadMsg:'正在加载，请稍候!',
				columns:[[  
				{field:'courseInfoId',title:'主键ID',width:80,hidden:true},  
				{field:'startDate',title:'开始时间',width:140},  
				{field:'endDate',title:'结束时间',width:140},
				{field:'cityName',title:'城市名',width:140,hidden:true},
				{field:'city',title:'城市',width:100,formatter:function(value,row){return row.cityName;}}
				]]
			});
		}else if(row&&row.isInner){
			$.messager.show({
				title : '温馨提示',
				msg : '内训课程无固定课程安排。',
				timeout : 2000,
				showType : 'slide'
			});
		}
		else {
			$.messager.show({
				title : '温馨提示',
				msg : '请先选择一行记录',
				timeout : 2000,
				showType : 'slide'
			});
		}
}

function newCourseInfo(){
	$('#dlg_addInfo').dialog('open').dialog('setTitle', '新增课程安排');
	$('#info-fm').form('clear');
	$('#sId_in_fm').val($('#selected_courseId').val());	
			//alert('sId_in_fm = '+$('#sId_in_fm').val());
		}

		function editCourseInfo(){
			var row;
			row = $('#dg_info').datagrid('getSelected');
			if (row) {
				$('#dlg_addInfo').dialog('open').dialog('setTitle', '编辑课程安排');
				$('#info-fm').form('load', row);
				$("#sId_in_fm").val($("#selected_courseId").val());	
			} else {
				$.messager.show({
					title : '温馨提示',
					msg : '请先选择一行记录',
					timeout : 2000,
					showType : 'slide'
				});
			}
		}

		function saveCourseInfo(){
			$('#info-fm').form('submit', {
				url : '../struts/Course_saveCourseInfo?objectName=courseInfo',
				onSubmit : function() {
					return $(this).form('validate');
				},
				success : function(data) {
					//alert(encodeURI(data));
					var data = eval('(' + data + ')'); // change the JSON string to javascript object  
					if (data.success) {
						//alert(data);
						//alert(data.message);
						$.messager.show({
							title : 'Success',
							msg : data.message,
							timeout : 3000,
							showType : 'fade'
						});
						$('#dg_info').datagrid('reload');
						$('#dg_info').datagrid('clearSelections');
						$('#dlg_addInfo').dialog('close'); // close the dialog  
					} else {
						$.messager.show({
							title : 'Error',
							msg : data.message,
							timeout : 3000,
							showType : 'fade'
						});
					}
				}
			});
		}

		function destroyCourseInfo(){
			var row;
			row = $('#dg_info').datagrid('getSelected');
			//alert(row);
			if (row) {
				$.messager
				.confirm(
					'Confirm',
					'确认要删除此行记录吗?',
					function(r) {
						if (r) {
							$
							.post(
								'../struts/Course_deleteCourseInfo?objectName=courseInfo',
								row,
								function(data) {
									if (data.success) {
										$('#dg_info')
										.datagrid(
																				'reload'); // reload the Dic data
										$('#dg_info').datagrid('clearSelections');
									} else {
										$.messager
										.show({
											title : 'Error',
											msg : data.message,
											timeout : 3000,
											showType : 'fade'
										});
										$('#dg_info')
										.datagrid(
											'reload');
										$('#dg_info').datagrid('clearSelections');
									}
								}, 'json');
						}
					});
			}else{
				$.messager.show({
					title : '温馨提示',
					msg : '请先选择一行记录',
					timeout : 2000,
					showType : 'slide'
				});
			}
		}

		function cutupTitle(){
			//var textToCut = encodeURIComponent($('#courseTitle').val());
			var textToCut = $('#courseTitle').val();
			//alert('courseTitle = ' + textToCut);
			if($('#courseTitle').validatebox('isValid')){
				//alert('textToCut to cut ' + $('#courseTitle').val());
				$.ajax({
					url:'../struts/Solr_cutText?textToCut='+textToCut,
					success: function(data){
						$('#courseKeywords').val(data);
					}		
				});
			}
			
		}
		</script>
		<style type="text/css">
		#fm {
			margin: 0;
			padding: 10px 40px;
		}

		.ftitle {
			font-size: 14px;
			font-weight: bold;
			padding: 5px 0;
			margin-bottom: 10px;
			border-bottom: 1px solid #ccc;
		}

		.fitem {
			margin-bottom: 5px;
		}

		.fitem label {
			display: inline-block;
			width: 80px;
		}

		.itemText {
			width: 300px;
			text-align: left;
			height: 30px;
			padding-left: 10px;
			vertical-align: top
		}

		.formTable td {
			vertical-align: top
		}
		</style>
	</body>
	</html>