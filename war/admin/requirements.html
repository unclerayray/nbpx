	<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
	<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" type="text/css" href="../js/easyui/themes/default/easyui.css">
		<link rel="stylesheet" type="text/css" href="../css/demo.css">
		<link rel="stylesheet" type="text/css" href="../js/easyui/themes/icon.css">
		<script src="../js/easyui/jquery-1.8.0.min.js"></script>
		<script src="../js/easyui/jquery.easyui.min.js"></script>
		<link rel="stylesheet" type="text/css" href="../js/poshytip-1.2/src/tip-skyblue/tip-skyblue.css">
		<link rel="stylesheet" type="text/css" href="../js/poshytip-1.2/src/tip-darkgray/tip-darkgray.css">
		<script src="../js/poshytip-1.2/src/jquery.poshytip.min.js"></script>
		<script src="../js/easyui/plugins/jquery.validatebox.js"></script>
		<title>需求管理</title>
	</head>
	<table id="dg" class="easyui-datagrid"  pagination="true"  pageSize=20  
	loadMsg="正在加载，请稍候!"
	data-options="autoRowHeight:true,fit:true,rownumbers:true,remoteSort: true,singleSelect:true,url:'../struts/Requirement_queryRequirements',toolbar:'#tb'">
	<thead>
		<tr>
			<th data-options="field:'requirementId',width:80,hidden:true">主键</th>
			<th data-options="field:'username',width:40",align:'center'>用户名</th>
			<th data-options="field:'requiredCourse',width:120">课程名</th>
			<th data-options="field:'headCount',width:30,sortable:true,align:'center'">人数</th>
			<th data-options="field:'validDays',width:30">有效天数</th>
			<th data-options="field:'startTime',width:70">开始时间</th>
			<th data-options="field:'endTime',width:70">结束时间</th>
			<th data-options="field:'city',width:40">城市</th>
			<th data-options="field:'contact',width:50">联系人</th>
			<th data-options="field:'telephone',width:60">电话</th>
			<th data-options="field:'cellphone',width:60">手机</th>
			<th data-options="field:'comp_name',width:60">公司名</th>
			<th data-options="field:'description',width:120">需求描述</th>
			<th data-options="field:'reply',width:120">跟进</th>
			<th data-options="field:'email',width:80">邮件</th>
			<th data-options="field:'hasReplied',width:50,align:'center',formatter:function(value,row){if(row.hasReplied) {return '已跟进';}else{return '<font color=red>未跟进</font>';}}">跟进</th>
			<th data-options="field:'createDate',width:70,align:'center',sortable:true">创建时间</th>
		</tr>
	</thead>
	</table>


	<div id="tb" style="padding: 5px; height: auto">
		<div style="margin-bottom: 5px">
		跟进情况：<select id="p_replay" name="p_replay" class="easyui-combobox"
			data-options=" panelHeight:'50',
						strict:true" 
			style="panelHeight: 50px;">
			<option></option>
			<option value="ed">已跟进</option>
			<option value="un">未跟进</option>
		</select>
		公司名称： <input  name="q_company"
	id="q_company"  style="width:50px">
	联系人： <input  name="q_contact"
	id="q_contact"  style="width:50px">
	<a href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-search" onclick="queryRequirements()">搜索</a> <a
	href="javascript:void(0)" class="easyui-linkbutton"
	iconCls="icon-undo" onclick="$('#tb').form('clear');">重置</a><a href="#"
			class="easyui-linkbutton" iconCls="icon-add" plain="true"
			onclick="openDlg()">跟进</a>
		</div>
	</div>


	<div id="dlg" class="easyui-dialog"
	style="width: 360px; height: 300px; padding: 5px 5px" closed="true"  cache="false" 
	modal="true" data-options="buttons: [{
	text:'保存',
	iconCls:'icon-ok',
	handler:function(){
	replyRequire(); } },{
	text:'取消',
	iconCls:'icon-cancel',
	handler:function(){
	$('#dlg').dialog('close');
	}
	}]">
	<form id="fm" method="post">
		<tr>
		<td class="itemText" >
		<div>
			<input id="requireId" name="requireId" type="hidden">
			<textarea class="easyui-textarea" id="replys" name="replys" data-options="required:true,tipPositionY:'center',tipPositionX:'right',className:'tip-darkgray',missingMessage:'需求跟进的不能为空'"
			style="width: 260px; height: 180px;" maxlength="200" type="textarea" required="true"></textarea>
		</div>
		</td>
		</tr>
	</form>
	</div>

	<script type="text/javascript">
		function queryRequirements() {
			var comp = $('#q_company').val();
			var cont = $('#q_contact').val();
			if ($('#p_replay').combobox('getValue') == 'ed') {
				$('#dg').datagrid('load', {hasReplied : 1, q_company: comp , q_contact:cont });
			}else if($('#p_replay').combobox('getValue') == 'un'){
				$('#dg').datagrid('load', {hasReplied : 0, q_company: comp , q_contact:cont });
			}else{
				$('#dg').datagrid('load',{reply : 98, q_company: comp , q_contact:cont });
			}
		}

		function openDlg(){
			var row= $('#dg').datagrid('getSelected');
			if (row) {
				$('#fm').form('clear');$('#dlg').dialog('open').dialog('setTitle', '跟进');
				$('#requireId').val(row.requirementId);
				$('#replys').val(row.reply);
			}else{
				$.messager.show({
					title : '温馨提示',
					msg : '请先选择一行记录',
					timeout : 2000,
					showType : 'slide'
				});
			}
		}

		function replyRequire(){
			$('#fm').form('submit', {
				url : '../struts/Requirement_replyRequirement?reply='+$('#replys').val()+'&requirementId='+$('#requireId').val(),
				onSubmit : function() {
					return $(this).form('validate');
				},
				success : function(data) {
					var data = eval('(' + data + ')'); // change the JSON string to javascript object  
					if (data.success) {
						$.messager.show({
							title : 'Success',
							msg : data.message,
							timeout : 3000,
							showType : 'fade'
						});
						$('#dlg').dialog('close'); // close the dialog  
						$('#dg').datagrid('reload'); // reload
						$('#dg_followups').datagrid('reload'); // reload
					} else {
						$.messager.show({
							title : 'Error',
							msg : data.message,
							timeout : 3000,
							showType : 'fade'
						});
					}
				}
			});
		}

		
	</script>	
			<style type="text/css">
			#fm {
				margin: 0;
				padding: 10px 40px;
			}

			.ftitle {
				font-size: 14px;
				font-weight: bold;
				padding: 5px 0;
				margin-bottom: 10px;
				border-bottom: 1px solid #ccc;
			}

			.fitem {
				margin-bottom: 5px;
			}

			.fitem label {
				display: inline-block;
				width: 80px;
			}

			.itemText {
				width: 300px;
				text-align: left;
				height: 30px;
				padding-left: 10px;
				vertical-align: top
			}

			.formTable td {
				vertical-align: top
			}
			</style>
		</body>
		</html>