<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../js/easyui/themes/gray/easyui.css">
<link rel="stylesheet" type="text/css" href="../js/easyui/themes/icon.css"/>
<script type="text/javascript" src="../js/easyui/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="../js/easyui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../js/easyui/locale/easyui-lang-zh_CN.js"></script>
<style>
	.itemText{width:100px;text-align:right;;height:30px;padding-right:10px; vertical-align:top}
	.formTable td{vertical-align:top}
</style>
<script language="JavaScript">
	var cityDics = [];
	//console.log('before load');
	$.ajax('../struts/Dictionary_getComboDicByType?p_dicType=007', {
		type : 'POST',
		dataType : 'json',
		success : function(data) {
			cityDics = data;
		}
	});
</script>
<title>用户列表</title>
	<script type="text/javascript">
		var toolbar = [
		{text: ' 用户名:<input type="text" id="p_userName"/>'},
		{
			text:'查询',
			iconCls:'icon-search',
			handler:function(){
				$('#grid').datagrid('load', {
					username : $('#p_userName').val()
				});
			}
		},'-',{
			text:'激活',
			iconCls:'icon-remove',
			handler:function(){
				var currUser = $('#grid').datagrid('getSelected');
				var index = $('#grid').datagrid('getRowIndex',currUser);
				currUser.state = 'true';
				$.ajax({
					url:'../struts/User_saveUser?objectName=user',
					data:currUser,
					success:function(){
						$('#grid').datagrid('reload');
					}
				})
			}
		},{
			text:'锁定',
			iconCls:'icon-add',
			handler:function(){
				var currUser = $('#grid').datagrid('getSelected');
				var index = $('#grid').datagrid('getRowIndex',currUser);
				currUser.state = 'false';
				$.ajax({
					url:'../struts/User_saveUser?objectName=user',
					data:currUser,
					success:function(){
						$('#grid').datagrid('reload');
					}
				})
			}
		},{
			text:'重置密码',
			iconCls:'icon-edit',
			handler:function(){
				var currUser = $('#grid').datagrid('getSelected');
				var index = $('#grid').datagrid('getRowIndex',currUser);
				currUser.passWord = '123456';
				$.ajax({
					url:'../struts/User_saveUser?objectName=user',
					data:currUser,
					success:function(){
						$('#grid').datagrid('reload');
						alert("已成功将密码重置为123456!");//$('#grid').datagrid('refreshRow',index);
					}
				})
			}
		}];
	</script>
</head>
<body class="easyui-layout">
	<div region="center" border="false" style='padding:5px'>  
		<table class="easyui-datagrid" id="grid" 
				data-options="fit:true,rownumbers:true,singleSelect:true,url:'../struts/User_queryUserByType',toolbar:toolbar,
					singleSelect:true,
					autoRowHeight:false,
					pagination:true,
					pageSize:20">
			<thead>
				<tr>
					<th data-options="field:'userId',width:80,hidden:true">主键</th> 
					<th data-options="field:'userName',sortable:true,width:120">用户名</th>
					<th data-options="field:'typeName',sortable:true,width:120">用户类型</th>
					<th data-options="field:'city',sortable:true,width:120,formatter:function(value,row){
							for(var i=0; i<cityDics.length; i++){
			                    if (cityDics[i].codeName == value) return cityDics[i].showName;
			                }
							return value;
						}">所在城市</th>
					<th data-options="field:'email',sortable:true,width:200">邮箱</th>
					<th data-options="field:'registerDate',sortable:true,width:200">注册时间</th>
					<th data-options="field:'state',width:100,sortable:true,formatter:function(value,row){if(row.state) return '已激活';else return '<font color=red>锁定</font>';}  ">状态</th>
				</tr>
			</thead>
		</table>
	</div>
</body>
</html>